<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gifty</title>
  <!-- Include Vue.js from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/vue@3"></script>
  <!-- Link to style.css -->
  <link rel="stylesheet" href="style.css">
  <!-- Include Gadget client script -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://gifty--development.gadget.app/api/client/web.min.js"></script>
  <script>

function getUrlParams() {
    const params = new URLSearchParams(window.location.search);
    return {
      campaignId: params.get('campaignId') || 'defaultCampaignId', // Default value if not present
      linkId: params.get('linkId') || 'defaultLinkId' // Default value if not present
    };
  }

    window.api = new Gadget();

    async function fetchLinks(campaignId,linkId) {

      let campaign = await api.campaign.findMany({
        filter: {
          id: {
            equals: campaignId,
          },
        },
      });

      console.log("campaign")
      console.log(campaign)

      campaign = campaign[0]

      console.log(campaign.shopName)

      const linkYO = await api.links.findOne(linkId);

      console.log("linkYO")
      console.log(linkYO)

      let link = await api.links.findMany({
        filter: {
          campaignId: {
            equals: linkId,
          },
        },
      });

     // link = link[0];
     
      let products = JSON.parse(linkYO.products);
      
      return { products, shopName: campaign.shopName }; // Return the products and shopName
    }
  </script>
  <style>
     body {
      font-family: 'Poppins', sans-serif; /* Use Poppins font */
    }
    .submit-container{
      display:flex;
      align-items:center;
      justify-content: center;
      margin-top:5px;
    }
    .shipping-container{
      display:flex;
      align-items:center;
      justify-content: center;
      flex-direction: column;
      margin-top:5px;
    }
    .toast {
      visibility: hidden;
      min-width: 250px;
      margin-left: -125px;
      background-color: #333;
      color: #fff;
      text-align: center;
      border-radius: 2px;
      padding: 14px 32px;
      position: fixed;
      z-index: 1;
      left: 50%;
      bottom: 30px;
      font-size: 17px;
    }

    .toast.show {
      visibility: visible;
      -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
      animation: fadein 0.5s, fadeout 0.5s 2.5s;
    }

    .shop-container{
      display:flex;
      padding:25px;
      background: #fafafa;
      justify-content: center;
      height:65px;
    }

    @-webkit-keyframes fadein {
      from {bottom: 0; opacity: 0;}
      to {bottom: 30px; opacity: 1;}
    }

    @keyframes fadein {
      from {bottom: 0; opacity: 0;}
      to {bottom: 30px; opacity: 1;}
    }

    @-webkit-keyframes fadeout {
      from {bottom: 30px; opacity: 1;}
      to {bottom: 0; opacity: 0;}
    }

    @keyframes fadeout {
      from {bottom: 30px; opacity: 1;}
      to {bottom: 0; opacity: 0;}
    }
  </style>
</head>

<body>
  <div id="app">
    <div class="shop-container" v-if="shopName">
      <h2>{{ shopName }}'s Gift Form</h2>
    </div>
    <div class="header-container">
      <h1 class="header">Contact</h1>
    </div>
    <div class="form-container">

      <div class="custom-input">
        <input type="text" v-model="firstName" placeholder="First Name" autocomplete="off" />
      </div>
      <div class="custom-input">
        <input type="text" v-model="lastName" placeholder="Last Name" autocomplete="off" />
      </div>
      <div class="custom-input">
        <input type="email" v-model="email" placeholder="Email" autocomplete="off" />
      </div>
      <div class="custom-input">
        <input type="text" v-model="instagram" placeholder="Instagram" autocomplete="off" />
      </div>
      <div class="custom-input">
        <input type="text" v-model="tiktok" placeholder="TikTok" autocomplete="off" />
      </div>

    </div>
    <div class="product-container">
      <h1 class="header">Choose products</h1>
      <div class="dub-product-container">
        <div v-for="(product, index) in products" :key="index" class="item-container">
          <img :src="product.images[0].originalSrc" :alt="product.title"
            style="width: 100px; height: 100px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);" />
          <div style = "display:flex;flex-direction:column"> 
          <div class="product-title">{{ product.title }} - ${{ product.variants[0].price }}</div>
          <button @click="addToCart(product)"
            style="background-color: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">Add
            to Cart</button>
            </div>
        </div>
      </div>
    </div>
    <div class="shipping-container">
      <h1 class="header">Shipping details</h1>
      <div class="custom-input">
        <input type="text" v-model="address" placeholder="Address" autocomplete="off" />
      </div>
      <div class="custom-input">
        <input type="text" v-model="unitNo" placeholder="Unit No" autocomplete="off" />
      </div>
      <div class="custom-input">
        <input type="text" v-model="city" placeholder="City" autocomplete="off" />
      </div>
      <div class="custom-input">
        <input type="text" v-model="country" placeholder="Country" autocomplete="off" />
      </div>
      <div class="custom-input">
        <input type="text" v-model="zipCode" placeholder="Zip Code" autocomplete="off" />
      </div>
    </div>
    <div class="submit-container">
      <button @click="submitForm"
        style="background-color: #008CBA; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">Submit</button>
    </div>
    <div id="toast" class="toast">Product added to cart!</div>
  </div>

  <script>
    // Create a new Vue instance
    const app = Vue.createApp({
      data() {
        return {
          message: 'Hello Vue!',
          firstName: '',
          lastName: '',
          email: '',
          instagram: '',
          tiktok: '',
          address: '',
          unitNo: '',
          city: '',
          country: '',
          zipCode: '',
          products: [], // Assuming products data will be populated
          cart: [], // Array to hold products added to the cart
          shopName: '' // Variable to hold the shop name
        }
      },
      async mounted() {
        const { campaignId, linkId } = getUrlParams(); 
        console.log(campaignId)
        console.log(linkId)
        const data = await fetchLinks(campaignId,linkId); // Fetch and set products and shopName when the component is mounted
        this.products = data.products;
        this.shopName = data.shopName;
      },
      methods: {
        addToCart(product) {
          this.cart.push(product);
          console.log('Product added to cart:', product);
          this.showToast();
        },
        showToast() {
          const toast = document.getElementById("toast");
          toast.className = "toast show";
          setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000);
        },
        async submitForm() {
          const orderRecord = await api.order.create({
            cart: JSON.stringify(this.products), // Use this.products to reference the data property
            linkId: "example value for linkId",
          });
          console.log('Order created:', orderRecord);
        }
      }
    });
    app.mount('#app');
  </script>
</body>

</html>